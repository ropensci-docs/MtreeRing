<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function is used to automatically detect tree ring 
borders along the user-defined path."><title>Automatic detection of tree-ring borders — ring_detect • MtreeRing</title><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic detection of tree-ring borders — ring_detect"><meta property="og:description" content="This function is used to automatically detect tree ring 
borders along the user-defined path."><meta property="og:image" content="https://docs.ropensci.org/MtreeRing/logo.png"><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">MtreeRing</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.4.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/app-MtreeRing.html">A Simple Workflow for Shiny App</a>
    <a class="dropdown-item" href="../articles/detection-MtreeRing.html">MtreeRing: Measuring Tree Ring Width in R</a>
    <a class="dropdown-item" href="../articles/pith-MtreeRing.html">Measure Tree Rings on Pith Side</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/MtreeRing">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Automatic detection of tree-ring borders</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/MtreeRing/blob/HEAD/R/ring_detect.R" class="external-link"><code>R/ring_detect.R</code></a></small>
      <div class="d-none name"><code>ring_detect.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is used to automatically detect tree ring 
borders along the user-defined path.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ring_detect</span><span class="op">(</span><span class="va">ring.data</span>, seg <span class="op">=</span> <span class="fl">1</span>, auto.path <span class="op">=</span> <span class="cn">TRUE</span>, manual <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"canny"</span>, incline <span class="op">=</span> <span class="cn">FALSE</span>, sample.yr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  watershed.threshold <span class="op">=</span> <span class="st">"auto"</span>, watershed.adjust <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  struc.ele1 <span class="op">=</span> <span class="cn">NULL</span>, struc.ele2 <span class="op">=</span> <span class="cn">NULL</span>, marker.correction <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  default.canny <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">canny.t1</span>, <span class="va">canny.t2</span>, canny.smoothing <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  canny.adjust <span class="op">=</span> <span class="fl">1.4</span>, path.dis <span class="op">=</span> <span class="fl">1</span>, origin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  border.color <span class="op">=</span> <span class="st">"black"</span>, border.type <span class="op">=</span> <span class="fl">16</span>, label.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  label.cex <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>ring.data</dt>
<dd><p>A magick image object produced by <code><a href="ring_read.html">ring_read</a></code>.</p></dd>


<dt>seg</dt>
<dd><p>An integer specifying the number of image segments.</p></dd>


<dt>auto.path</dt>
<dd><p>A logical value. If <code>TRUE</code>, a path is automatically 
created at the center of the image. If <code>FALSE</code>, the function allows 
the user to create a sub-image and a path by interactive clickings. 
See details below.</p></dd>


<dt>manual</dt>
<dd><p>A logical value indicating whether to skip the automatic 
detection. If <code>TRUE</code>, ring borders are visually identified after 
creating the path. See <code><a href="ring_modify.html">ring_modify</a></code> to learn how to mark
tree rings by clicking on the image.</p></dd>


<dt>method</dt>
<dd><p>A character string specifying how ring borders are detected. 
It requires one of the following characters: <code>"watershed"</code>, 
<code>"canny"</code>, or <code>"lineardetect"</code>. See details below.</p></dd>


<dt>incline</dt>
<dd><p>A logical value indicating whether to correct ring widths. 
If <code>TRUE</code>, two horizontal paths are added to the image.</p></dd>


<dt>sample.yr</dt>
<dd><p><code>NULL</code> or an integer giving the year of formation 
of the left-most ring. If <code>NULL</code>, use the current year.</p></dd>


<dt>watershed.threshold</dt>
<dd><p>The threshold used for producing the marker 
image, either a numeric from 0 to 1, or the character "auto" (using the 
Otsu algorithm), or a character of the form "XX%" (e.g., "58%").</p></dd>


<dt>watershed.adjust</dt>
<dd><p>A numeric used to adjust the Otsu threshold. 
The default is 1 which means that the threshold will not be adjusted. 
The sizes of early-wood regions in the marker image will reduce along 
with the decrease of <code>watershed.adjust</code>.</p></dd>


<dt>struc.ele1</dt>
<dd><p><code>NULL</code> or a vector of length two specifying the 
width and height of the first structuring element. If <code>NULL</code>, the 
size of the structuring element is determined by the argument <code>dpi</code>.</p></dd>


<dt>struc.ele2</dt>
<dd><p><code>NULL</code> or a vector of length two specifying the 
width and height of the second structuring element. If <code>NULL</code>, the 
size of the structuring element is determined by the argument <code>dpi</code>.</p></dd>


<dt>marker.correction</dt>
<dd><p>A logical value indicating whether to relabel 
early-wood regions by comparing the values of their left-side neighbours.</p></dd>


<dt>default.canny</dt>
<dd><p>A logical value. If <code>TRUE</code>, upper and lower 
Canny thresholds are determined automatically.</p></dd>


<dt>canny.t1</dt>
<dd><p>A numeric giving the threshold for weak edges.</p></dd>


<dt>canny.t2</dt>
<dd><p>A numeric giving the threshold for strong edges.</p></dd>


<dt>canny.smoothing</dt>
<dd><p>An integer specifying the degree of smoothing.</p></dd>


<dt>canny.adjust</dt>
<dd><p>A numeric used as a sensitivity control factor for 
the Canny edge detector. The default is 1 which means that the sensitivity 
will not be adjusted. The number of detected borders will reduce along 
with the increase of this value.</p></dd>


<dt>path.dis</dt>
<dd><p>A numeric specifying the perpendicular distance between 
two paths when the argument <code>incline = TRUE</code>. The unit is in mm.</p></dd>


<dt>origin</dt>
<dd><p>A numeric specifying the origin in smoothed gray to find 
ring borders. See <code>ringBorders</code> from the package 
<code>measuRing</code>.</p></dd>


<dt>border.color</dt>
<dd><p>Color for ring borders.</p></dd>


<dt>border.type</dt>
<dd><p>Symbol for ring borders. See <code>pch</code> in 
<code><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></code> for possible values and their shapes.</p></dd>


<dt>label.color</dt>
<dd><p>Color for years and border numbers.</p></dd>


<dt>label.cex</dt>
<dd><p>The magnification to be used for years and border numbers.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A matrix (grayscale image) or array (color image) 
representing the tree-ring image.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>auto.path = FALSE</code>, the user can create a rectangular sub-image 
and a horizontal path by interactively clicking on the tree ring image. 
The automatic detection will be performed within this rectangular 
sub-image. 
To create a sub-image and a path, follow these steps.</p><ul><li><p>Step 1. Select the left and right edges of the rectangle</p>  
<p>The user can point the mouse at any 
  desired locations and click the left mouse button to add each edge.</p></li>
<li><p>Step 2. Select the top and bottom edges of the rectangle</p>  
<p>The user can point the mouse at any desired locations and click the 
  left mouse button to add each edge. The width of the rectangle is 
  defined as the distance between the top and bottom edges, and should 
  not be unnecessarily large to reduce time consumption and memory usage. 
  Creating a long and narrow rectangle if possible.</p></li>
<li><p>Step 3. Create a path</p>  
<p>After creating the rectangular sub-image, the user can add a horizontal 
  path by left-clicking on the sub-image (generally at the center of the 
  sub-image, try to choose a clean defect-free area). Ring borders and 
  other markers are plotted along this path. If <code>incline = TRUE</code>, 
  two paths are added simultaneously.</p></li>
</ul><p>After creating the sub-image and the path, this function will open several 
graphics windows and plot detected ring borders on image segments. The 
number of image segments is controlled by the argument <code>seg</code>.</p>
<p>Argument <code>method</code> determines how ring borders are identified.</p><ul><li><p>If <code>method = "watershed"</code>, this function uses the watershed algorithm 
  to obtain ring borders (Soille and Misson, 2001).</p></li>
<li><p>If <code>method = "canny"</code>, this function uses the Canny algorithm 
  to detect borders.</p></li>
<li><p>If <code>method = "lineardetect"</code>, a linear detection algorithm from the 
  package <code>measuRing</code> is used to identify ring borders (Lara 
  et al., 2015). Note that <code>incline = TRUE</code> is not supported in this 
  mode, and path will be automatically created at the center of the image.</p></li>
</ul><p>If the argument <code>method = "watershed"</code> or <code>"canny"</code>, the original 
image is processed by morphological openings and closings using rectangular 
structuring elements of increasing size before detecting borders. The first 
small structuring element is used to remove smaller dark spots in early 
wood regions, and the second large structuring element is used to remove 
light strips in late wood regions. More details about morphological 
processing can be found at Soille and Misson (2001).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function uses <code><a href="https://rdrr.io/r/graphics/locator.html" class="external-link">locator</a></code> to record mouse 
positions so it only works on "X11", "windows" and "quartz" devices.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Soille, P., Misson, L. (2001)
Tree ring area measurements using morphological image analysis.
<em>Canadian Journal of Forest Research</em>
<b>31</b>, 1074-1083. doi: 10.1139/cjfr-31-6-1074</p>
<p>Lara, W., Bravo, F., Sierra, C.A. (2015)
measuRing: An R package to measure tree-ring widths from scanned images.
<em>Dendrochronologia</em>
<b>34</b>, 43-50. doi: 10.1016/j.dendro.2015.04.002</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jingning Shi</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">img.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"001.png"</span>, package <span class="op">=</span> <span class="st">"MtreeRing"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Read a tree ring image:</span></span></span>
<span class="r-in"><span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="ring_read.html">ring_read</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">img.path</span>, dpi <span class="op">=</span> <span class="fl">1200</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Split a long core sample into 3 pieces to</span></span></span>
<span class="r-in"><span><span class="co">## get better display performance and use the</span></span></span>
<span class="r-in"><span><span class="co">## watershed algorithm to detect ring borders:</span></span></span>
<span class="r-in"><span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu">ring_detect</span><span class="op">(</span><span class="va">t1</span>, seg <span class="op">=</span> <span class="fl">3</span>, method <span class="op">=</span> <span class="st">'watershed'</span>, border.color <span class="op">=</span> <span class="st">'green'</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The sampling year is set to the current year</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>

  

  

  </body></html>

